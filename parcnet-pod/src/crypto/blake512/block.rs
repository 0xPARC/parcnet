use crate::crypto::blake512::blake512_impl::{Blake512, BLOCK_SIZE};

const CST0: u64 = 0x243F6A8885A308D3;
const CST1: u64 = 0x13198A2E03707344;
const CST2: u64 = 0xA4093822299F31D0;
const CST3: u64 = 0x082EFA98EC4E6C89;
const CST4: u64 = 0x452821E638D01377;
const CST5: u64 = 0xBE5466CF34E90C6C;
const CST6: u64 = 0xC0AC29B7C97C50DD;
const CST7: u64 = 0x3F84D5B5B5470917;
const CST8: u64 = 0x9216D5D98979FB1B;
const CST9: u64 = 0xD1310BA698DFB5AC;
const CST10: u64 = 0x2FFD72DBD01ADFB7;
const CST11: u64 = 0xB8E1AFED6A267E96;
const CST12: u64 = 0xBA7C9045F12C7F99;
const CST13: u64 = 0x24A19947B3916CF7;
const CST14: u64 = 0x0801F2E2858EFC16;
const CST15: u64 = 0x636920D871574E69;

impl Blake512 {
    pub fn block(&mut self, p: &[u8]) {
        let (mut h0, mut h1, mut h2, mut h3, mut h4, mut h5, mut h6, mut h7) = (
            self.h[0], self.h[1], self.h[2], self.h[3], self.h[4], self.h[5], self.h[6], self.h[7],
        );

        let (s0, s1, s2, s3) = (self.s[0], self.s[1], self.s[2], self.s[3]);

        let mut p = p.to_vec();

        while p.len() >= BLOCK_SIZE {
            let (mut v0, mut v1, mut v2, mut v3, mut v4, mut v5, mut v6, mut v7) =
                (h0, h1, h2, h3, h4, h5, h6, h7);
            let mut v8 = CST0 ^ s0;
            let mut v9 = CST1 ^ s1;
            let mut v10 = CST2 ^ s2;
            let mut v11 = CST3 ^ s3;
            let mut v12: u64 = CST4;
            let mut v13: u64 = CST5;
            let mut v14: u64 = CST6;
            let mut v15: u64 = CST7;

            self.t = self.t.wrapping_add(1024);

            if !self.nullt {
                v12 ^= self.t;
                v13 ^= self.t;
                // TODO: Ideally, self.t must be a 128-bit integer. Currently, only 2^64 bits are supporteself.
                // In Rust, you can use a 128-bit integer library like `u128` from the `num-bigint` crate.
                // Example:
                // v14 ^= self.t as u128;
                // v15 ^= self.t as u128;
                v14 ^= 0;
                v15 ^= 0;
            }

            let mut m: [u64; 16] = [0; 16];
            let mut j = 0;

            for mi in &mut m {
                *mi = (u64::from(p[j]) << 56)
                    | (u64::from(p[j + 1]) << 48)
                    | (u64::from(p[j + 2]) << 40)
                    | (u64::from(p[j + 3]) << 32)
                    | (u64::from(p[j + 4]) << 24)
                    | (u64::from(p[j + 5]) << 16)
                    | (u64::from(p[j + 6]) << 8)
                    | u64::from(p[j + 7]);

                j += 8;
            }

            // Round 1.
            v0 = v0.wrapping_add(m[0] ^ CST1);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(25);

            v1 = v1.wrapping_add(m[2] ^ CST3);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(25);

            v2 = v2.wrapping_add(m[4] ^ CST5);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(25);

            v3 = v3.wrapping_add(m[6] ^ CST7);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(25);

            v2 = v2.wrapping_add(m[5] ^ CST4);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(11);

            v3 = v3.wrapping_add(m[7] ^ CST6);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(11);

            v1 = v1.wrapping_add(m[3] ^ CST2);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(11);

            v0 = v0.wrapping_add(m[1] ^ CST0);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(11);

            v0 = v0.wrapping_add(m[8] ^ CST9);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(25);

            v1 = v1.wrapping_add(m[10] ^ CST11);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(25);

            v2 = v2.wrapping_add(m[12] ^ CST13);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(25);

            v3 = v3.wrapping_add(m[14] ^ CST15);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(25);

            v2 = v2.wrapping_add(m[13] ^ CST12);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(11);

            v3 = v3.wrapping_add(m[15] ^ CST14);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(11);

            v1 = v1.wrapping_add(m[11] ^ CST10);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(11);

            v0 = v0.wrapping_add(m[9] ^ CST8);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(11);

            // Round 2.
            v0 = v0.wrapping_add(m[14] ^ CST10);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(25);

            v1 = v1.wrapping_add(m[4] ^ CST8);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(25);

            v2 = v2.wrapping_add(m[9] ^ CST15);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(25);

            v3 = v3.wrapping_add(m[13] ^ CST6);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(25);

            v2 = v2.wrapping_add(m[15] ^ CST9);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(11);

            v3 = v3.wrapping_add(m[6] ^ CST13);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(11);

            v1 = v1.wrapping_add(m[8] ^ CST4);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(11);

            v0 = v0.wrapping_add(m[10] ^ CST14);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(11);

            v0 = v0.wrapping_add(m[1] ^ CST12);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(25);

            v1 = v1.wrapping_add(m[0] ^ CST2);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(25);

            v2 = v2.wrapping_add(m[11] ^ CST7);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(25);

            v3 = v3.wrapping_add(m[5] ^ CST3);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(25);

            v2 = v2.wrapping_add(m[7] ^ CST11);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(11);

            v3 = v3.wrapping_add(m[3] ^ CST5);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(11);

            v1 = v1.wrapping_add(m[2] ^ CST0);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(11);

            v0 = v0.wrapping_add(m[12] ^ CST1);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(11);

            // Round 3.
            v0 = v0.wrapping_add(m[11] ^ CST8);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(25);

            v1 = v1.wrapping_add(m[12] ^ CST0);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(25);

            v2 = v2.wrapping_add(m[5] ^ CST2);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(25);

            v3 = v3.wrapping_add(m[15] ^ CST13);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(25);

            v2 = v2.wrapping_add(m[2] ^ CST5);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(11);

            v3 = v3.wrapping_add(m[13] ^ CST15);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(11);

            v1 = v1.wrapping_add(m[0] ^ CST12);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(11);

            v0 = v0.wrapping_add(m[8] ^ CST11);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(11);

            v0 = v0.wrapping_add(m[10] ^ CST14);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(25);

            v1 = v1.wrapping_add(m[3] ^ CST6);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(25);

            v2 = v2.wrapping_add(m[7] ^ CST1);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(25);

            v3 = v3.wrapping_add(m[9] ^ CST4);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(25);

            v2 = v2.wrapping_add(m[1] ^ CST7);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(11);

            v3 = v3.wrapping_add(m[4] ^ CST9);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(11);

            v1 = v1.wrapping_add(m[6] ^ CST3);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(11);

            v0 = v0.wrapping_add(m[14] ^ CST10);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(11);

            // Round 4.
            v0 = v0.wrapping_add(m[7] ^ CST9);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(25);

            v1 = v1.wrapping_add(m[3] ^ CST1);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(25);

            v2 = v2.wrapping_add(m[13] ^ CST12);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(25);

            v3 = v3.wrapping_add(m[11] ^ CST14);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(25);

            v2 = v2.wrapping_add(m[12] ^ CST13);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(11);

            v3 = v3.wrapping_add(m[14] ^ CST11);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(11);

            v1 = v1.wrapping_add(m[1] ^ CST3);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(11);

            v0 = v0.wrapping_add(m[9] ^ CST7);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(11);

            v0 = v0.wrapping_add(m[2] ^ CST6);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(25);

            v1 = v1.wrapping_add(m[5] ^ CST10);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(25);

            v2 = v2.wrapping_add(m[4] ^ CST0);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(25);

            v3 = v3.wrapping_add(m[15] ^ CST8);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(25);

            v2 = v2.wrapping_add(m[0] ^ CST4);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(11);

            v3 = v3.wrapping_add(m[8] ^ CST15);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(11);

            v1 = v1.wrapping_add(m[10] ^ CST5);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(11);

            v0 = v0.wrapping_add(m[6] ^ CST2);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(11);

            // Round 5.
            v0 = v0.wrapping_add(m[9] ^ CST0);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(25);

            v1 = v1.wrapping_add(m[5] ^ CST7);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(25);

            v2 = v2.wrapping_add(m[2] ^ CST4);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(25);

            v3 = v3.wrapping_add(m[10] ^ CST15);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(25);

            v2 = v2.wrapping_add(m[4] ^ CST2);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_right(11);

            v3 = v3.wrapping_add(m[15] ^ CST10);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_right(11);

            v1 = v1.wrapping_add(m[7] ^ CST5);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_right(11);

            v0 = v0.wrapping_add(m[0] ^ CST9);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_right(11);

            v0 = v0.wrapping_add(m[14] ^ CST1);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(25);

            v1 = v1.wrapping_add(m[11] ^ CST12);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(25);

            v2 = v2.wrapping_add(m[6] ^ CST8);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(25);

            v3 = v3.wrapping_add(m[3] ^ CST13);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(25);

            v2 = v2.wrapping_add(m[8] ^ CST6);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_right(11);

            v3 = v3.wrapping_add(m[13] ^ CST3);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_right(11);

            v1 = v1.wrapping_add(m[12] ^ CST11);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_right(11);

            v0 = v0.wrapping_add(m[1] ^ CST14);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_right(11);

            // Round 6.
            v0 = v0.wrapping_add(m[2] ^ CST12);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[6] ^ CST10);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[0] ^ CST11);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[8] ^ CST3);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[11] ^ CST0);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[3] ^ CST8);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[10] ^ CST6);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[12] ^ CST2);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[4] ^ CST13);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[7] ^ CST5);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[15] ^ CST14);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[1] ^ CST9);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[14] ^ CST15);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[9] ^ CST1);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[5] ^ CST7);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[13] ^ CST4);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11);

            // Round 7.
            v0 = v0.wrapping_add(m[12] ^ CST5);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[1] ^ CST15);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[14] ^ CST13);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[4] ^ CST10);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[13] ^ CST14);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[10] ^ CST4);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[15] ^ CST1);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[5] ^ CST12);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[0] ^ CST7);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[6] ^ CST3);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[9] ^ CST2);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[8] ^ CST11);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[2] ^ CST9);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[11] ^ CST8);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[3] ^ CST6);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[7] ^ CST0);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11);

            // Round 8.
            v0 = v0.wrapping_add(m[13] ^ CST11);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[7] ^ CST14);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[12] ^ CST1);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[3] ^ CST9);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[1] ^ CST12);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[9] ^ CST3);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[14] ^ CST7);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[11] ^ CST13);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[5] ^ CST0);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[15] ^ CST4);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[8] ^ CST6);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[2] ^ CST10);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[6] ^ CST8);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[10] ^ CST2);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[4] ^ CST15);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[0] ^ CST5);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11);

            // Round 9.
            v0 = v0.wrapping_add(m[6] ^ CST15);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[14] ^ CST9);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[11] ^ CST3);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[0] ^ CST8);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[3] ^ CST11);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[8] ^ CST0);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[9] ^ CST14);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[15] ^ CST6);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[12] ^ CST2);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25);

            v1 = v1.wrapping_add(m[13] ^ CST7);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[1] ^ CST4);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25);

            v3 = v3.wrapping_add(m[10] ^ CST5);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25);

            v2 = v2.wrapping_add(m[4] ^ CST1);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11);

            v3 = v3.wrapping_add(m[5] ^ CST10);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11);

            v1 = v1.wrapping_add(m[7] ^ CST13);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11);

            v0 = v0.wrapping_add(m[2] ^ CST12);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11);

            // Round 10.
            v0 = v0.wrapping_add(m[10] ^ CST2);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[8] ^ CST4);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[7] ^ CST6);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[1] ^ CST5);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[6] ^ CST7);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[5] ^ CST1);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[4] ^ CST8);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[2] ^ CST10);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[15] ^ CST11);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[9] ^ CST14);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[3] ^ CST12);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[13] ^ CST0);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[12] ^ CST3);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[0] ^ CST13);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[14] ^ CST9);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[11] ^ CST15);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 11.
            v0 = v0.wrapping_add(m[0] ^ CST1);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[2] ^ CST3);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[4] ^ CST5);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[6] ^ CST7);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[5] ^ CST4);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[7] ^ CST6);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[3] ^ CST2);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[1] ^ CST0);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[8] ^ CST9);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[10] ^ CST11);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[12] ^ CST13);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[14] ^ CST15);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[13] ^ CST12);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[15] ^ CST14);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[11] ^ CST10);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[9] ^ CST8);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 12.
            v0 = v0.wrapping_add(m[14] ^ CST10);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[4] ^ CST8);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[9] ^ CST15);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[13] ^ CST6);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[15] ^ CST9);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[6] ^ CST13);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[8] ^ CST4);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[10] ^ CST14);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[1] ^ CST12);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[0] ^ CST2);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[11] ^ CST7);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[5] ^ CST3);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[7] ^ CST11);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[3] ^ CST5);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[2] ^ CST0);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[12] ^ CST1);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 13.
            v0 = v0.wrapping_add(m[11] ^ CST8);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[12] ^ CST0);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[5] ^ CST2);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[15] ^ CST13);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[2] ^ CST5);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[13] ^ CST15);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[0] ^ CST12);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[8] ^ CST11);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[10] ^ CST14);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[3] ^ CST6);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[7] ^ CST1);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[9] ^ CST4);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[1] ^ CST7);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[4] ^ CST9);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[6] ^ CST3);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[14] ^ CST10);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 14.
            v0 = v0.wrapping_add(m[7] ^ CST9);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[3] ^ CST1);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[13] ^ CST12);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[11] ^ CST14);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[12] ^ CST13);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[14] ^ CST11);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[1] ^ CST3);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[9] ^ CST7);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[2] ^ CST6);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[5] ^ CST10);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[4] ^ CST0);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[15] ^ CST8);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[0] ^ CST4);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[8] ^ CST15);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[10] ^ CST5);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[6] ^ CST2);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 15.
            v0 = v0.wrapping_add(m[9] ^ CST0);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[5] ^ CST7);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[2] ^ CST4);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[10] ^ CST15);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[4] ^ CST2);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[15] ^ CST10);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[7] ^ CST5);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[0] ^ CST9);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[14] ^ CST1);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[11] ^ CST12);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[6] ^ CST8);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[3] ^ CST13);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[8] ^ CST6);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[13] ^ CST3);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[12] ^ CST11);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[1] ^ CST14);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            // Round 16.
            v0 = v0.wrapping_add(m[2] ^ CST12);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v1 = v1.wrapping_add(m[6] ^ CST10);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v2 = v2.wrapping_add(m[0] ^ CST11);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v3 = v3.wrapping_add(m[8] ^ CST3);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v2 = v2.wrapping_add(m[11] ^ CST0);
            v2 = v2.wrapping_add(v6);
            v14 ^= v2;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v10 = v10.wrapping_add(v14);
            v6 ^= v10;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v3 = v3.wrapping_add(m[3] ^ CST8);
            v3 = v3.wrapping_add(v7);
            v15 ^= v3;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v11 = v11.wrapping_add(v15);
            v7 ^= v11;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v1 = v1.wrapping_add(m[10] ^ CST6);
            v1 = v1.wrapping_add(v5);
            v13 ^= v1;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v9 = v9.wrapping_add(v13);
            v5 ^= v9;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);
            v0 = v0.wrapping_add(m[12] ^ CST2);
            v0 = v0.wrapping_add(v4);
            v12 ^= v0;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v8 = v8.wrapping_add(v12);
            v4 ^= v8;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v0 = v0.wrapping_add(m[4] ^ CST13);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 32) | v15.rotate_right(32);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 25) | v5.rotate_right(25);
            v1 = v1.wrapping_add(m[7] ^ CST5);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 32) | v12.rotate_right(32);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 25) | v6.rotate_right(25);
            v2 = v2.wrapping_add(m[15] ^ CST14);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 32) | v13.rotate_right(32);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 25) | v7.rotate_right(25);
            v3 = v3.wrapping_add(m[1] ^ CST9);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 32) | v14.rotate_right(32);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 25) | v4.rotate_right(25);
            v2 = v2.wrapping_add(m[14] ^ CST15);
            v2 = v2.wrapping_add(v7);
            v13 ^= v2;
            v13 = v13.rotate_left(64 - 16) | v13.rotate_right(16);
            v8 = v8.wrapping_add(v13);
            v7 ^= v8;
            v7 = v7.rotate_left(64 - 11) | v7.rotate_right(11);
            v3 = v3.wrapping_add(m[9] ^ CST1);
            v3 = v3.wrapping_add(v4);
            v14 ^= v3;
            v14 = v14.rotate_left(64 - 16) | v14.rotate_right(16);
            v9 = v9.wrapping_add(v14);
            v4 ^= v9;
            v4 = v4.rotate_left(64 - 11) | v4.rotate_right(11);
            v1 = v1.wrapping_add(m[5] ^ CST7);
            v1 = v1.wrapping_add(v6);
            v12 ^= v1;
            v12 = v12.rotate_left(64 - 16) | v12.rotate_right(16);
            v11 = v11.wrapping_add(v12);
            v6 ^= v11;
            v6 = v6.rotate_left(64 - 11) | v6.rotate_right(11);
            v0 = v0.wrapping_add(m[13] ^ CST4);
            v0 = v0.wrapping_add(v5);
            v15 ^= v0;
            v15 = v15.rotate_left(64 - 16) | v15.rotate_right(16);
            v10 = v10.wrapping_add(v15);
            v5 ^= v10;
            v5 = v5.rotate_left(64 - 11) | v5.rotate_right(11);

            h0 ^= v0 ^ v8 ^ s0;
            h1 ^= v1 ^ v9 ^ s1;
            h2 ^= v2 ^ v10 ^ s2;
            h3 ^= v3 ^ v11 ^ s3;
            h4 ^= v4 ^ v12 ^ s0;
            h5 ^= v5 ^ v13 ^ s1;
            h6 ^= v6 ^ v14 ^ s2;
            h7 ^= v7 ^ v15 ^ s3;

            p = p[BLOCK_SIZE..].to_vec();
        }

        self.h[0] = h0;
        self.h[1] = h1;
        self.h[2] = h2;
        self.h[3] = h3;
        self.h[4] = h4;
        self.h[5] = h5;
        self.h[6] = h6;
        self.h[7] = h7;
    }
}
